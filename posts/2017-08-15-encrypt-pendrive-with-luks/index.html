<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Blog  | Encrypt pendrive with LUKS</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.37.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/blog/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Encrypt pendrive with LUKS" />
<meta property="og:description" content="Encrypt pendrive with LUKS [Published Medium]
 Have you ever wanted to own an encrypted pendrive which will be unreadable and uncrackable (with strong enough password) to third parties without your password?
 Your files on laptop may be encrypted and safe but what about the files on pendrives you use? Removing a file from unencrypted pendrive does not make it impossible to retrieve it. Encrypt a pendrive and you can be always safe." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hoto.github.io/blog/posts/2017-08-15-encrypt-pendrive-with-luks/" />



<meta property="article:published_time" content="2017-08-15T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-08-15T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Encrypt pendrive with LUKS">
<meta itemprop="description" content="Encrypt pendrive with LUKS [Published Medium]
 Have you ever wanted to own an encrypted pendrive which will be unreadable and uncrackable (with strong enough password) to third parties without your password?
 Your files on laptop may be encrypted and safe but what about the files on pendrives you use? Removing a file from unencrypted pendrive does not make it impossible to retrieve it. Encrypt a pendrive and you can be always safe.">


<meta itemprop="datePublished" content="2017-08-15T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2017-08-15T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="588">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Encrypt pendrive with LUKS"/>
<meta name="twitter:description" content="Encrypt pendrive with LUKS [Published Medium]
 Have you ever wanted to own an encrypted pendrive which will be unreadable and uncrackable (with strong enough password) to third parties without your password?
 Your files on laptop may be encrypted and safe but what about the files on pendrives you use? Removing a file from unencrypted pendrive does not make it impossible to retrieve it. Encrypt a pendrive and you can be always safe."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://hoto.github.io/blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      Blog
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Encrypt pendrive with LUKS</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2017-08-15T00:00:00Z">August 15, 2017</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div class="sect1">
<h2 id="_encrypt_pendrive_with_luks">Encrypt pendrive with LUKS</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>[Published <a href="https://medium.com/@AndrzejRehmann/encrypt-pendrive-with-luks-a58989889d36">Medium</a>]</em></p>
</div>
<div class="paragraph">
<p>Have you ever wanted to own an encrypted pendrive which will be unreadable and uncrackable (with strong enough password) to third parties without your password?</p>
</div>
<div class="paragraph">
<p>Your files on laptop may be encrypted and safe but what about the files on pendrives you use? Removing a file from unencrypted pendrive does not make it impossible to retrieve it. Encrypt a pendrive and you can be always safe.</p>
</div>
<div class="paragraph">
<p>Password for encrypted pendrive can easily be changed without modifying or erasing the pendrive contents.</p>
</div>
<div class="paragraph">
<p>In this episode we will encrypt pendrive with <code>LUKS</code> and format it with <code>ext4</code> or <code>ntfs</code> filesystem. Your pendrive data will be removed in the process so back it up.</p>
</div>
<hr>
<div class="paragraph">
<p>Switch to root.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">su -</code></pre>
</div>
</div>
<div class="paragraph">
<p>Put the pendrive in and list all disks in order to find your pendrive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">lsblk</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/001.png" alt="001">
</div>
<div class="title">Figure 1. /dev/sdb1 is our pendrive partition and it’s mounted</div>
</div>
<div class="paragraph">
<p>Locate your pendrive. My pendrive called <code>64GB</code> is device <code>/dev/sdb</code> with one partition <code>/dev/sdb1</code> mounted under <code>/run/media/andrzej.rehmann/64GB</code> .</p>
</div>
<div class="paragraph">
<p>Move all your data to a save place as we will remove all pendrive content.</p>
</div>
<div class="paragraph">
<p>Unmount pendrive and check the result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">umount /dev/&lt;pendrive_partition&gt;
lsblk</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/002.png" alt="002">
</div>
<div class="title">Figure 2. /dev/sdb1 should have no mountpoint</div>
</div>
<hr>
<div class="paragraph">
<p>We will now encrypt the pendrive. This will remove all pendrive contents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cryptsetup luksFormat /dev/&lt;pendrive_device&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/003.png" alt="003">
</div>
<div class="title">Figure 3. Confirm overwriting pendrive content and type your new password.</div>
</div>
<div class="paragraph">
<p>That’s it. Pendrive is now encrypted but is not usable yet.</p>
</div>
<hr>
<div class="paragraph">
<p>We will now create filesystem on our pendrive.</p>
</div>
<div class="paragraph">
<p>First let’s decrypt/open it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cryptsetup luksOpen /dev/&lt;pendrive_device&gt; &lt;luks_name&gt;
lsblk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>&lt;luks_name&gt;</code> is some random string of your choosing (this is not a persistent name, don’t worry).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/004.png" alt="004">
</div>
<div class="title">Figure 4. Decrypted (opened) pendrive.</div>
</div>
<div class="paragraph">
<p>You can overwrite pendrive with <a href="https://linux.die.net/man/1/shred"><code>shred</code></a> to wipe it’s previous content but it can take a while. I’m not going to do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">shred -n 1 mapper/&lt;luks_name&gt;</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Create file system. I’m using <a href="https://en.wikipedia.org/wiki/Ext4"><code>ext4</code></a>, but you can choose other filesystem like <code>NTFS</code> or <code>FAT</code>.</p>
</div>
<div class="paragraph">
<p>For <code>ext4</code> which will work on Linux no problem but will require additional software on Windows use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mkfs -t ext4 -L "&lt;label&gt;" /dev/mapper/&lt;luks_name&gt;   # Ext4</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Ext4 is a journalling filesystem which means that if the device is unplugged prematurely it stands more of a chance of recovering the damaged filesystem. It can support volumes up to 1 ExbiByte (a lot).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>For <code>NTFS</code> which should work on Windows no problem but may require additional software on some Linux distributions use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mkfs -t ntfs -L "&lt;label&gt;" /dev/mapper/&lt;luks_name&gt;   # NTFS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>&lt;label&gt;</code> is your new pendrive name.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/005.png" alt="005">
</div>
<div class="title">Figure 5. I’m formatting my pendrive with ext4 as I only use Linux.</div>
</div>
<hr>
<div class="paragraph">
<p>After <code>mkfs</code> is finished pull out the pendrive and plug it back in. You should see a modal window asking for you pendrive password.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/006.png" alt="006">
</div>
</div>
<div class="paragraph">
<p>If you don’t see this window open file browser and click on the pendrive as if you wanted to browse its content. You should be asked for a password then.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/007.png" alt="007">
</div>
</div>
<div class="paragraph">
<p>It’s done. You can check that indeed your pendrive is now encrypted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">lsblk</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/008.png" alt="008">
</div>
</div>
<div class="paragraph">
<p>If you see the <code>luks-UUID</code> as the partition name it means that that partition is encrypted. My <code>/dev/sdc</code> (it switched from <code>/dev/sdb</code> ) pendrive is now encrypted.</p>
</div>
<hr>
<div class="paragraph">
<p>The last step is necessary only if you used <code>ext4</code> file system. Your pendrive is owned by root user at the moment so you won’t be able to write to it, we need to fix this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">chown -R &lt;user&gt;:&lt;user&gt; &lt;pendrive_mount_point&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/009.png" alt="009">
</div>
</div>
<div class="paragraph">
<p>No my pendrive is owned by my user and ready to use.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2017-08-15-encrypt-pendrive-with-luks/010.png" alt="010">
</div>
</div>
<hr>
<div class="paragraph">
<p>If you are interested with installing a Fedora 26 with ZFS and encryption then check out my series here: <a href="https://medium.com/@AndrzejRehmann/preparing-fedora-laptop-with-zfs-and-encryption-part-1-f5788dda79ab" class="bare">https://medium.com/@AndrzejRehmann/preparing-fedora-laptop-with-zfs-and-encryption-part-1-f5788dda79ab</a></p>
</div>
</div>
</div>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://hoto.github.io/blog/" >
    &copy; 2019 Blog
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/blog/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
