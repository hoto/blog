<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Blog  | Creating a Jenkinsfile pipeline</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.37.1" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/blog/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Creating a Jenkinsfile pipeline" />
<meta property="og:description" content="Creating a Jenkinsfile pipeline [Published Medium]
 Basics of setting up a Jenkins multibranch pipeline job and defining a Jenkinsfile.
  Figure 1. Photo by Bernard Hermant on Unsplash    Creating Multibranch Pipeline Job If you want to follow this article but don’t have a Jenkins instance at hand you can use my GitHub project to spin up a dockerized Jenkins:
 git clone https://github.com/hoto/jenkinsfile-examples.git cd jenkinsfile-examples docker-compose pull docker-compose up   Let’s open Jenkins by going to localhost:8080" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hoto.github.io/blog/posts/2019-02-25-creating-a-jenkinsfile-pipeline/" />



<meta property="article:published_time" content="2019-02-25T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2019-02-25T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Creating a Jenkinsfile pipeline">
<meta itemprop="description" content="Creating a Jenkinsfile pipeline [Published Medium]
 Basics of setting up a Jenkins multibranch pipeline job and defining a Jenkinsfile.
  Figure 1. Photo by Bernard Hermant on Unsplash    Creating Multibranch Pipeline Job If you want to follow this article but don’t have a Jenkins instance at hand you can use my GitHub project to spin up a dockerized Jenkins:
 git clone https://github.com/hoto/jenkinsfile-examples.git cd jenkinsfile-examples docker-compose pull docker-compose up   Let’s open Jenkins by going to localhost:8080">


<meta itemprop="datePublished" content="2019-02-25T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-02-25T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="934">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Creating a Jenkinsfile pipeline"/>
<meta name="twitter:description" content="Creating a Jenkinsfile pipeline [Published Medium]
 Basics of setting up a Jenkins multibranch pipeline job and defining a Jenkinsfile.
  Figure 1. Photo by Bernard Hermant on Unsplash    Creating Multibranch Pipeline Job If you want to follow this article but don’t have a Jenkins instance at hand you can use my GitHub project to spin up a dockerized Jenkins:
 git clone https://github.com/hoto/jenkinsfile-examples.git cd jenkinsfile-examples docker-compose pull docker-compose up   Let’s open Jenkins by going to localhost:8080"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://hoto.github.io/blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      Blog
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Creating a Jenkinsfile pipeline</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-02-25T00:00:00Z">February 25, 2019</time>      
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div class="sect1">
<h2 id="_creating_a_jenkinsfile_pipeline">Creating a Jenkinsfile pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>[Published <a href="https://medium.com/@AndrzejRehmann/creating-a-jenkinsfile-pipeline-7aefc89b8c67">Medium</a>]</em></p>
</div>
<div class="paragraph">
<p>Basics of setting up a Jenkins multibranch pipeline job and defining a Jenkinsfile.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/pipeline.jpg" alt="Pipeline">
</div>
<div class="title">Figure 1. Photo by <a href="https://unsplash.com/photos/Zpdb7-owcpw?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Bernard Hermant</a> on <a href="https://unsplash.com/search/photos/pipeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_multibranch_pipeline_job">Creating Multibranch Pipeline Job</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to follow this article but don’t have a Jenkins instance at hand you can use my GitHub project to spin up a dockerized Jenkins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git clone https://github.com/hoto/jenkinsfile-examples.git
cd jenkinsfile-examples
docker-compose pull
docker-compose up</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s open Jenkins by going to <code>localhost:8080</code></p>
</div>
<div class="paragraph">
<p>There are already a couple of jobs there but ignore them as we will be creating a new job.</p>
</div>
<div class="sect2">
<h3 id="_creating_new_job">Creating new job</h3>
<div class="paragraph">
<p>Click on <code>New Item</code> to open a job creation wizard.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/001.png" alt="001">
</div>
</div>
<div class="paragraph">
<p>Provide <code>my-pipeline-job</code> as the name for the job and select the <code>Multibranch Pipeline</code> as the type then click <code>OK</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/002.png" alt="002">
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><code>Pipeline</code> job type lets you either paste a Jenkinsfile directly into the job config or reference a single git repository as the source then specify single branch where the Jenkinsfile is located. It is rarely the case where you want to use this job type, it’s better to be avoided.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><code>Multibranch Pipeline</code> job type lets you define a job where from a single git repository Jenkins will detect multiple branches and create nested jobs when it finds a Jenkinsfile. This is the best way of using Jenkins pipelines.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_defining_jenkinsfile_source">Defining Jenkinsfile source</h3>
<div class="paragraph">
<p>Add a <code>Git</code> source and provide the <code><a href="https://github.com/hoto/jenkinsfile-examples.git" class="bare">https://github.com/hoto/jenkinsfile-examples.git</a></code> repository link.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/003.png" alt="003">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/004.png" alt="004">
</div>
</div>
<div class="paragraph">
<p>Default place where Jenkins is looking for a Jenkinsfile is the root of the project with <code>Jenkinsfile</code> as the filename.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Jenkinsfile can be put in any directory and the filename can be whatever you want. But I would follow the default convention of using the root of the project and the <code>Jenkinsfile</code> as the filename unless you have a good reason not to.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>One Jenkins job can only reference a single Jenkinsfile. If you have more Jenkinsfiles in your repository you will have to create a <code>Multibranch Pipeline</code> job for each one of them.</p>
</div>
<div class="paragraph">
<p>Provide <code>jenkinsfiles/001-stages-declarative-style.groovy</code> as the Jenkinsfile <code>Script Path</code>. We could also specify a regex for only specific branches to be scanned but I prefer to scan and build all branches.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/005.png" alt="005">
</div>
</div>
<div class="paragraph">
<p>Jenkinsfile that we referenced is very simple and looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">pipeline {
  agent any
  stages {
  stage('Stage 1') {
      steps {
        script {
          echo 'Stage 1'
        }
      }
    }
  stage('Stage 2') {
      steps {
        script {
          echo 'Stage 2'
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_detecting_changes_by_polling">Detecting changes by polling</h3>
<div class="paragraph">
<p>Jenkins can be immediately notified by changes (e.g. new commits) in your repository by an external webhook, but if you don’t know how to set it up you can always start with Jenkins polling your git repository and checking for new changes.</p>
</div>
<div class="paragraph">
<p>Activate <code>Scan Multibranch Pipeline Triggers</code> making Jenkins <code>git fetch</code> for new changes in 1-minute intervals. When new commits or branches are detected Jenkins will automatically start a build.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/006.png" alt="006">
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If you can then set up a webhook in your git hosting provider to notify Jenkins about new changes as it makes the build feedback loop for developers much faster.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Click on <code>Save</code> and Jenkins will start the first scan.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/007.png" alt="007">
</div>
</div>
<div class="paragraph">
<p>What happened is that Jenkins cloned the repository and looked in each branch for a Jenkinsfile. When it finds a match it creates nested jobs for each branch and runs builds for them. In our current set up Jenkins will do this cycle every minute.</p>
</div>
<div class="paragraph">
<p>At the time of writing this article, only <code>master</code> branch matches my job criteria. So only one job has been created.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Checking branches...
  Checking branch master
      ‘jenkinsfiles/001-stages-declarative-style.groovy’ found
    Met criteria</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nested_jobs">Nested jobs</h3>
<div class="paragraph">
<p>Let’s have a look at what Jenkins created.</p>
</div>
<div class="paragraph">
<p>Go back to Jenkins home and click on <code>my-pipeline-job</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/008.png" alt="008">
</div>
</div>
<div class="paragraph">
<p>If you ever have problems with jobs for branches not being created or built automatically check the <code>Scan Multibranch Pipeline Log</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/009.png" alt="009">
</div>
</div>
<div class="paragraph">
<p>This is the same log view we saw before but logs are going to be refreshed every minute or when someone clicks on the <code>Scan Multibranch Pipeline Now</code> link.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/010.png" alt="010">
</div>
</div>
<div class="paragraph">
<p>From my experience, this view is the best way to debug issues with multibranch pipelines. If you ever see a timeout on a <code>git</code> command it usually means Jenkins can’t access the git repository.</p>
</div>
<div class="paragraph">
<p>Following log tells us that only 1 branch has been detected and Jenkins already have a build for the commit on that branch.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>No changes detected: master (still at c9b78b77a085becd313f1efff2497)
Processed 1 branches</pre>
</div>
</div>
<div class="paragraph">
<p>Go back to nested jobs view and click on the job for the <code>master</code> branch.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/011.png" alt="011">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/012.png" alt="012">
</div>
</div>
<div class="paragraph">
<p>If the referenced git repository never changes then no build will be ever run again. If you want to you can always trigger a build manually by clicking on the <code>Build Now</code> link. This is useful when the build fails for random reasons.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_automatic_branch_detection">Automatic branch detection</h3>
<div class="paragraph">
<p>For the sake of this tutorial, I’m going to create a new branch and push it to the repository so we can test if a new nested job is created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/013.png" alt="013">
</div>
<div class="title">Figure 2. Creating and pushing a new git branch</div>
</div>
<div class="paragraph">
<p>After a minute a new job for <code>creating-a-jenkins-pipeline-blog</code> branch has been automatically created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/014.png" alt="014">
</div>
</div>
<div class="paragraph">
<p>From the logs, we can see that Jenkins detected new branch matching pipeline criteria and scheduled a build for it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Started by timer
[...]
Checking branches...
  Checking branch master
      ‘jenkinsfiles/001-stages-declarative-style.groovy’ found
    Met criteria
No changes detected: master (still at c9b78b77a085becd313f1efff249)
  Checking branch creating-a-jenkinsfile-pipeline-blog
      ‘jenkinsfiles/001-stages-declarative-style.groovy’ found
    Met criteria
Scheduled build for branch: creating-a-jenkinsfile-pipeline-blog
Processed 2 branches</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/images/2019-02-25-creating-a-jenkinsfile-pipeline/015.png" alt="015">
</div>
</div>
<hr>
<div class="paragraph">
<p>That’s it! Next steps would be to create a webhook for instantaneous builds and modifying the Jenkinsfile to do something useful like build and deploy your application.</p>
</div>
<div class="paragraph">
<p>In my series about Jenkins I have more blogs, so far there is only one more:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/@AndrzejRehmann/private-jenkins-shared-libraries-540abe7a0ab7">Private Jenkins Shared Libraries</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://hoto.github.io/blog/" >
    &copy; 2019 Blog
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/blog/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
